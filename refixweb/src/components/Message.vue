<template>
  <div id="messager" class="wrapper">
    <div class="container chat-box-msg">
      <aside class="user">
        <header>
          <h1>Messenger</h1>
        </header>
        <ul>
          <li>
            <div class="avatar top">
              <img src="../assets/user-2.svg" alt="">
              <div class="online"></div>
            </div>
            <div class="user-list">
              <div class="user">
                <p>Air Legendary</p>
              </div>
              <div class="text">
                <p>Can't wait to see you!</p>
              </div>
            </div>
            <div class="time-stamp">
              <p>8.31 PM</p>
            </div>
          </li>
          <li>
            <div class="avatar top">
              <img src="../assets/user-2.svg" alt="">
              <div class="online"></div>
            </div>
            <div class="user-list">
              <div class="user">
                <p>Air Legendary</p>
              </div>
              <div class="text">
                <p>Can't wait to see you!</p>
              </div>
            </div>
            <div class="time-stamp">
              <p>8.31 PM</p>
            </div>
          </li>
          <li>
            <div class="avatar top">
              <img src="../assets/user-2.svg" alt="">
              <div class="online"></div>
            </div>
            <div class="user-list">
              <div class="user">
                <p>Air Legendary</p>
              </div>
              <div class="text">
                <p>Can't wait to see you!</p>
              </div>
            </div>
            <div class="time-stamp">
              <p>8.31 PM</p>
            </div>
          </li>
          <li>
            <div class="avatar top">
              <img src="../assets/user-2.svg" alt="">
              <div class="online"></div>
            </div>
            <div class="user-list">
              <div class="user">
                <p>Air Legendary</p>
              </div>
              <div class="text">
                <p>Can't wait to see you!</p>
              </div>
            </div>
            <div class="time-stamp">
              <p>8.31 PM</p>
            </div>
          </li>
          <li>
            <div class="avatar top">
              <img src="../assets/user-2.svg" alt="">
              <div class="online"></div>
            </div>
            <div class="user-list">
              <div class="user">
                <p>Air Legendary</p>
              </div>
              <div class="text">
                <p>Can't wait to see you!</p>
              </div>
            </div>
            <div class="time-stamp">
              <p>8.31 PM</p>
            </div>
          </li>
        </ul>
      </aside>
      <section id="chat-screen">
        <section id="message">
          <article>
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>I'm so hungry!</p>
              </div>
            </div>
          </article>
          <article class="right">
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>Me too. I need to eat somthing now</p>
              </div>
            </div>
          </article>
          <article>
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>I'm so hungry!</p>
              </div>
            </div>
          </article>
          <article class="right">
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>Me too. I need to eat somthing now</p>
              </div>
            </div>
          </article>
          <article>
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>I'm so hungry!</p>
              </div>
            </div>
          </article>
          <article class="right">
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>Me too. I need to eat somthing now</p>
              </div>
            </div>
          </article>
          <article>
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>I'm so hungry!</p>
              </div>
            </div>
          </article>
          <article class="right">
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>Me too. I need to eat somthing now</p>
              </div>
            </div>
          </article>
          <article>
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>But it time 12 PM</p>
              </div>
            </div>
          </article>
          <article class="right">
            <div class="avatar">
              <img src="../assets/user-2.svg" alt="">
            </div>
            <div class="msg">
              <div class="pointer"></div>
              <div class="inner-msg">
                <p>So sad bro</p>
              </div>
            </div>
          </article>
        </section>
        <div class="msg-compose">
          <textarea placeholder="Say something..."></textarea>
          <font-awesome-icon icon="paper-plane" class="icon"></font-awesome-icon>
        </div>
      </section>
    </div>

    <!-- <div class="row" style="height: 100vh;">
      <div class="col-4" style="height:100vh;">
        <div class="row p-2">
          <div class="col-2 pt-1">
            <img src="../assets/user-2.svg" alt class="imgContact">
          </div>
          <div class="col-9">
            <div class="row nameContact">
              <b>ABC Home Inc.</b>
            </div>
            <div class="row contactMessage">You: What you's name?</div>
          </div>
        </div>
        new contact 
        <div class="row p-2">
          <div class="col-2 pt-1">
            <img src="../assets/user-2.svg" alt class="imgContact">
          </div>
          <div class="col-9">
            <div class="row nameContact">
              <b>ABC Home Inc.</b>
            </div>
            <div class="row contactMessage">You: What you's name?</div>
          </div>
        </div>
      </div>
      <div class="col-8">
        <div class="row-md-2">
          <p class="nameContact mb-0 p-1">ABC Home Inc.</p>
        </div>
        <div class="row-md-8 p-2" id="messagerBox" style="border:1px solid black; height: 100vh;">
            <div class="col contacter">
                <img src="../assets/user-2.svg" style="width: 30px;height: 30px;">
                Hello
            </div>
            <div class="col you">
                Bello
                <img src="../assets/user-2.svg" style="width: 30px;height: 30px;">
            </div>
        </div>
        <div class="row-md-2 align-items-end">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              placeholder="Type a message."
              aria-describedby="button-addon1"
            >
            <button class="btn btn-outline-secondary" type="button" id="button-addon1">Button</button>
          </div>
        </div>
      </div>
    </div>
    <hr>
    temporary code for getting chat message here 
    <p>you are : {{user}}</p>
    <p>talking to : {{targetUser.name}}</p>
    <hr>
    <p>set user</p>
    there should be "fake login" button to set user in login page and keep current user in store.js
    <button @click="user = 'mr A'">mr A</button>
    <button @click="user = 'mr B'">mr B</button>
    <button @click="user = 'company A'">company A</button>
    <button @click="user = 'company B'">company B</button>
    <hr>
    <p>set chat target</p>
    this should be set when click on contact button in company page 
    <button @click="targetUser.name = 'mr A'">mr A</button>
    <button @click="targetUser.name = 'mr B'">mr B</button>
    <button @click="targetUser.name = 'company A'">company A</button>
    <button @click="targetUser.name = 'company B'">company B</button>
    <hr>
    <div v-if="targetUser.name">
      <div v-for="(text, index) in chat" :key="index" v-chat-scroll>
        {{user}} : {{text.user}} : {{text.targetUser.name}}
        <h1>first condition : {{text.user == user}}</h1>
        <h1>second condition : {{text.targetUser.name == user}}</h1>
        maybe this should be && ====> V change this later 
        <template v-if="text.user == user || text.targetUser.name == user">
          <h3>{{ text.user }}</h3>
          <p>{{ text.message }}</p>
        </template>
      </div>
      <div>
        <input type="text" v-model="message">
        <button @click="sendMessage">send</button>
      </div>
    </div> -->
    <!-- temporary code for getting chat message end here -->
  </div>
</template>

<script>
import Vue from "vue";
import io from "socket.io-client";
import VueChatScroll from "vue-chat-scroll";


import { library } from '@fortawesome/fontawesome-svg-core';
import { faPaperclip, faPaperPlane } from '@fortawesome/free-solid-svg-icons';
import { FontAwesomeIcon } from '@fortawesome/vue-fontawesome';

library.add(faPaperclip);
library.add(faPaperPlane);

Vue.component('font-awesome-icon', FontAwesomeIcon)

Vue.use(VueChatScroll);

export default {
  data() {
    return {
      user: "mr A",
      message: "",
      chat: [],
      socket: io("https://contact-dot-soa2019.appspot.com"),
      targetUser: {
        name: "",
        id: ""
      }
    };
  },
  methods: {
    sendMessage() {
      this.socket.emit("sendMessage", {
        user: this.user,
        message: this.message,
        targetUser: this.targetUser
      });
      this.message = "";
    }
  },
  mounted() {
    this.socket.on("message", data => {
      this.chat.push(data);
    });
  }
};
</script>

<style>
*{
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
#messager{
    font-family: "Playfair Display", serif;
    font-weight: 100;
    font-size: 10px;
}
#wrapper{
  width: 100%;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 2rem;
  background-color: rgb(204, 204, 204);
  color: #fff;
}
.chat-box-msg{
  margin-top: 1rem;
  margin-bottom: 1rem;
  width: 60%;
  height: 80%;
  display: flex;
  overflow: scroll;
  box-shadow: 1rem 2rem 4rem rgba(0, 0, 0, 0.2);
  min-width: 60rem;
}

.user#chat-screen{
  flex-grow: 1;
  height: 100%;
  min-width: 30rem;
}

.user{
  font-size: 1.2rem;
  background-color: #ffffff;
}

#chat-screen{
    background-image: linear-gradient(120deg, #2c92eb 0%, #2857d8 100%);
    background-size: cover;
}

.user header{
  background-color: #ffbb00;
  padding: 2rem 0;
  display: flex;
  align-items: center;
  justify-content: center
}
.user ul{
  height: 500px;
  list-style-type: none;
  overflow: scroll;
}
.user ul li{
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  border: 1px solid rgba(0, 0, 0, 0.2)
}
.user ul li:nth-last-child{
  border-bottom: none;
}
.user header h1{
  color: #fff;
  font-size: 4rem;
  font-weight: 100;
}
.avatar img{
  width: 4.5rem;
  height: 4.6rem;
  /* width: 7.5rem;
  height: 7.6rem; */
  border-radius: 50%;
}
.user .avatar{
  display: flex;
  margin: auto 0;
  padding: 1rem;
  position: relative;
}
.username{
  font-size: 3rem;
}
.user-list{
  flex-grow: 2;
  margin: auto 0;
}
.text{
  font-size: 0.7rem;
  margin: auto 0;
}
.time-stamp{
  font-size: 0.7rem;
  flex-grow: 0.3;
  margin: auto 0;
}
#chat-screen{
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  flex-grow: 2;
  color: #333;
}
#chat-screen .msg-compose{
  background-color: #fff;
  padding: 1rem;
  display: flex;
  justify-content: space-between;
}
#chat-screen .msg-compose textarea{
  font-size: 0.8rem;
  flex-grow: 2;
  margin: 0 1rem;
  resize: none;
  border: none;
  padding-top: 5px;
  height: 2rem;
  
}#chat-screen .msg-compose textarea:focus{
  outline: none;
}
#chat-screen .msg-compose .icon{
  color: #258bff;
  cursor: pointer;
  width: 1.7rem;
  height: 1.7rem;
}
#message{
  height: 500px;
  overflow: scroll;
  flex-grow: 2;
  padding: 1rem;
}
#message article{
  display: flex;
  justify-content: flex-start;
  margin-bottom: 2rem;
}
#message article .avatar{
  margin-right: 1rem;
}
#message .right .avatar{
  margin-right: 0;
}
.msg{
  display: flex;
  justify-content: space-between;
}
.msg .pointer{
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0 1rem 1.5rem 0;
  border-color: transparent #fff transparent transparent;
  margin: auto;
}
.inner-msg{
  background-color: #fff;
  width: 100%;
  padding: 1.5rem 1rem;
  border-radius: 0 4px 4px 4px;
  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
  text-align: left;
  margin: auto;
}
.right{
  flex-direction: row-reverse;
}
.right .msg{
  flex-direction: row-reverse;
}
.right .msg .pointer{
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 1.5rem 1rem 0 0;
  border-color: #fff transparent transparent transparent;
  margin: auto 0;
}
.right .msg .inner-msg{
  border-radius: 4px 0 4px 4px;
  box-shadow: -2px 2px 5px rgba(0, 0, 0, 0.1);
  text-align: right;
}
</style>
